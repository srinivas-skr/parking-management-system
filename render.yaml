services:
  - type: web
    name: parking-management-system
    env: java
    region: oregon
    plan: free
    buildCommand: |
      cd frontend && npm install && npm run build && \
      mkdir -p ../src/main/resources/static && \
      cp -r dist/* ../src/main/resources/static/ && \
      cd .. && ./mvnw clean package -DskipTests
    startCommand: java -jar target/*.jar
    healthCheckPath: /actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: MANAGEMENT_HEALTH_MAIL_ENABLED
        value: false
      - key: SERVER_PORT
        value: 8080
      - key: SPRING_DATASOURCE_URL
        value: jdbc:h2:mem:parkingdb
      - key: VITE_API_URL
        sync: false
